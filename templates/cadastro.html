{% extends "base.html" %}

{% block content %}
<section class="contact-form">
  <h1>Cadastrod de Produto</h1>
  <p>Preencha todas as tabelas</p>

  <form>
    <div class="input-group">
      <label for="name">Nome Produto</label>
      <input id="produto" name="produto" type="text"/>
    </div>
    <div class="input-group">
      <label for="name">Descrição</label>
      <textarea id="descricao" name="descricao" type="text" rows="4" cols="65"></textarea>
    </div>

    <div class="input-group">
      <label for="name">Marca</label>
      <input id="marca" name="marca" type="text"/>
    </div>

    <div class="input-group">
      <label for="name">Preço de Custo</label>
      <input id="preco_custo" name="preco_custo" type="text"/>
    </div>

    <div class="input-group">
      <label for="name">Preço de Venda</label>
      <input id="preco_venda" name="preco_venda" type="text"/>
    </div>
    <div class="input-group">
      <label for="name">Arquivo de Imagem</label>
      <input id="imagem" name="imagem" type="file"/>
    </div>

    <div class="input-group">
      <label for="name">embalagens:  </label>

      <input id="embalagens" name="embalagens" type="radio" value="UN" checked/>
      <label class="inline" for="embalagens">UN</label>

      <input id="embalagens" name="embalagens" type="radio" value="CX"/>
      <label class="inline" for="embalagens">CX</label>

      <input id="embalagens" name="embalagens" type="radio" value="KG"/>
      <label class="inline" for="embalagens">KG</label>

      <input id="embalagens" name="embalagens" type="radio" value="PT"/>
      <label class="inline" for="embalagens">PT</label>
    </div>


    <input name="secret" type="hidden" value="1b3a9374-1a8e-434e-90ab-21aa7b9b80e7"/>
    <button type="submit">Salvar</button>
  </form>
</section>

<div class="results">
  <h2>Form Data</h2>
  <pre></pre>
</div>
<script>
function handleFormSubmit(event) {
  var Img = $('input[name="imagem"]').get(0).files[0];
  event.preventDefault();

  const data = new FormData(event.target);

  const formJSON = Object.fromEntries(data.entries());

  data.append('img', Img);
  const results = document.querySelector('.results pre');
  //results.innerText = JSON.stringify(formJSON, null, 2);
  var formData = new FormData();
  formData.append("file", Img);
  formData.append("data", JSON.stringify(formJSON));
  results.innerText = formData;
  $.ajax({
    type: 'post',
    url: '/api/editdata',
    data: formData,
    contentType: false,
    processData: false,
    datatype: 'formData',
    dataType: "json",
    sucess: function(data){alert("Salvo com sucesso");},
    error: function(errMsg){
      alert("Erro ao salvar");
    }
  });
}

const form = document.querySelector('.contact-form');
form.addEventListener('submit', handleFormSubmit);
</script>
{% endblock %}